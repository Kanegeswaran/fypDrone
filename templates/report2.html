{% extends 'base.html' %}

{% block body %}  

<div class="mycontainer px-0 py-0">
    <div class="container p-0">
        <style>
            .container {
            width: 1200px;
            height: 2000px;
            }
        </style>
        <div class="row">
            <div class="container">
                <div class="chart-container" style="position: relative; height:450px; width:80%; overflow-x: scroll">
                    <canvas id="itemChart1"></canvas>
                </div>
                <div class="chart-container" style="position: relative; height:450px; width:80%; overflow-x: scroll; margin-top: 50px;">
                    <canvas id="itemChart2"></canvas>
                </div>
                <div class="chart-container" style="position: relative; height:450px; width:80%; overflow-x: scroll; margin-top: 50px;">
                    <canvas id="itemChart3"></canvas>
                </div>
                <div class="chart-container" style="position: relative; height:450px; width:80%; margin-top: 50px;">
                    <canvas id="itemChart4"></canvas>
                </div>
                <a href="/download-pdf/plastic_bag" class="btn btn-primary" style="background-color: rgb(255, 99, 132); border-color: darkred; color:black">Download Bag Report as PDF</a>
                <a href="/download-pdf/plastic_bottle" class="btn btn-primary" style="background-color: rgb(54, 162, 235, 1); border-color: darkblue; color:black">Download Bottle Report as PDF</a>
                <a href="/download-pdf/plastic_cup" class="btn btn-primary" style="background-color: rgb(255, 206, 86); border-color: orange; color:black">Download Cup Report as PDF</a>
            </div>
        </div>
    </div>
</div>

<script>
    async function fetchAndDisplay(chartId, url, label, color) {
        try {
            const response = await fetch(url, { cache: 'no-store' });
            const data = await response.json();

            var ctx = document.getElementById(chartId).getContext('2d');
            var chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.timestamp,
                    datasets: [{
                        label: label,
                        data: data.item_count,
                        borderColor: color,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false
                }
            });

            return data.total;
        } catch (error) {
            console.error('Error fetching data:', error);
            return 0;
        }
    }

    async function loadDataSequentially() {
        const totalBag = await fetchAndDisplay('itemChart1', '/data/plastic_bag', 'Bag Count', 'rgb(255, 99, 132)');
        const totalBottle = await fetchAndDisplay('itemChart2', '/data/plastic_bottle', 'Bottle Count', 'rgb(54, 162, 235)');
        const totalCup = await fetchAndDisplay('itemChart3', '/data/plastic_cup', 'Cup Count', 'rgb(255, 206, 86)');

        var ctx = document.getElementById('itemChart4').getContext('2d');
        var itemTypes = ['plastic_bag', 'plastic_bottle', 'plastic_cup']; 
        var itemCounts = [totalBag, totalBottle, totalCup];

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: itemTypes,
                datasets: [{
                    label: '',
                    data: itemCounts,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Total Number' 
                        },
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    loadDataSequentially();
</script>

<script>
    document.getElementById('page_title').innerText = "Livestreaming: Report";
</script>

{% endblock %}

